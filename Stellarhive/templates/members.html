{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4">成员列表</h2>
<div class="container" style="max-width: 900px;">
  <div class="card mb-4 p-4 shadow-sm">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <input type="text" class="form-control w-50" id="memberSearch" placeholder="搜索昵称、用户名或身份...">
      <span class="text-muted ms-3">共 {{ users|length }} 人</span>
    </div>
    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
      <table class="table table-striped align-middle" id="memberTable">
        <thead class="table-light">
          <tr>
            <th>昵称</th>
            <th>用户名</th>
            <th>身份</th>
            <th>积分</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
              <td>{{ user.nickname or user.username }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.role }}</td>
              <td>{{ user.score }}</td>
              <td>
                <a class="btn btn-info btn-sm" href="/profile/{{ user.id }}">查看主页</a>
                {% if current_user.role == 'admin' and user.id != current_user.id %}
                <form method="post" style="display:inline;">
                  <input type="hidden" name="user_id" value="{{ user.id }}">
                  <button class="btn btn-success btn-sm" name="action" value="add" title="加10分">+10分</button>
                  <button class="btn btn-danger btn-sm" name="action" value="sub" title="减10分">-10分</button>
                </form>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
      </table>
    </div>
  </div>
</div>
<script>
const memberSearch = document.getElementById('memberSearch');
memberSearch.addEventListener('input', function() {
  const value = this.value.toLowerCase();
  document.querySelectorAll('#memberTable tbody tr').forEach(row => {
    const nickname = row.children[0].innerText.toLowerCase();
    const username = row.children[1].innerText.toLowerCase();
    const role = row.children[2].innerText.toLowerCase();
    row.style.display = nickname.includes(value) || username.includes(value) || role.includes(value) ? '' : 'none';
  });
});
</script>
{% endblock %}